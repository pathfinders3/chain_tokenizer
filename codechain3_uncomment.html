<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript ì£¼ì„ ì œê±°ê¸°</title>
    <!-- styles moved to external file -->
    <link rel="stylesheet" href="codechain3_uncomment.css">
</head>
<body>
    <div class="container">
        <h1>ğŸ§¹ JavaScript ì£¼ì„ ì œê±°ê¸°</h1>
        <p class="description">Esprimaë¥¼ ì‚¬ìš©í•˜ì—¬ JavaScript ì½”ë“œì—ì„œ ì£¼ì„ì„ ì œê±°í•©ë‹ˆë‹¤ (ì¤„ êµ¬ì¡° ìœ ì§€)</p>

        <div class="editor-container">
            <div class="editor-section">
                <h2>ì…ë ¥ (ì£¼ì„ í¬í•¨)</h2>
                <textarea id="input" placeholder="ì—¬ê¸°ì— JavaScript ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
            </div>

            <div class="editor-section">
                <h2>ì¶œë ¥ (ì£¼ì„ ì œê±°ë¨) <span id="lineInfo" class="line-info"></span></h2>
                <textarea id="output" readonly placeholder="ì£¼ì„ì´ ì œê±°ëœ ì½”ë“œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤..."></textarea>
            </div>
        </div>

        <div class="button-container">
            <button id="removeBtn">ì£¼ì„ ì œê±°</button>
            <button id="restoreBtn">ì›ë³¸ ë¶ˆëŸ¬ì˜¤ê¸°</button>
            <button id="copyBtn">ê²°ê³¼ ë³µì‚¬</button>
            <button id="clearBtn">ì´ˆê¸°í™”</button>
        </div>

        <div id="status" class="status">
            <span id="statusMessage"></span>
            <button id="statusCloseBtn" class="status-close-btn">Ã—</button>
        </div>

        <!-- ì—¬ëŸ¬ ì¤„ ì£¼ì„ ë³´ê¸° ì˜ì—­ -->
        <div class="comments-section" id="commentsSection" style="display: none;">
            <h2>ì—¬ëŸ¬ ì¤„ ì£¼ì„ ëª©ë¡</h2>
            <div class="comments-list" id="commentsList"></div>
            <div class="comment-detail">
                <h3>ì£¼ì„ ìƒì„¸</h3>
                <textarea id="commentDetail" readonly placeholder="ì£¼ì„ì„ ì„ íƒí•˜ì„¸ìš”..."></textarea>
            </div>
        </div>
    </div>

    <!-- Esprima CDN -->
    <script src="https://cdn.jsdelivr.net/npm/esprima@4.0.1/dist/esprima.min.js"></script>

    
    <!-- Comment Remover Library -->
    <script src="codechain3_uncomment.js"></script>

    <script>
        (function() {
            var inputTextarea = document.getElementById('input');
            var outputTextarea = document.getElementById('output');
            var removeBtn = document.getElementById('removeBtn');
            var restoreBtn = document.getElementById('restoreBtn');
            var clearBtn = document.getElementById('clearBtn');
            var copyBtn = document.getElementById('copyBtn');
            var statusDiv = document.getElementById('status');
            var statusMessage = document.getElementById('statusMessage');
            var statusCloseBtn = document.getElementById('statusCloseBtn');
            var lineInfo = document.getElementById('lineInfo');

            // ë‹«ê¸° ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
            statusCloseBtn.addEventListener('click', function() {
                statusDiv.style.display = 'none';
            });

            // ì¤„ ë²ˆí˜¸ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
            function updateLineNumber() {
                var text = outputTextarea.value;
                var cursorPos = outputTextarea.selectionStart;
                
                if (!text) {
                    lineInfo.textContent = '';
                    return;
                }
                
                // ì»¤ì„œ ìœ„ì¹˜ê¹Œì§€ì˜ ì¤„ë°”ê¿ˆ ê°œìˆ˜ ì„¸ê¸°
                var textBeforeCursor = text.substring(0, cursorPos);
                var lineNumber = (textBeforeCursor.match(/\n/g) || []).length + 1;
                
                // ì „ì²´ ì¤„ ìˆ˜
                var totalLines = (text.match(/\n/g) || []).length + 1;
                
                lineInfo.textContent = '(ì¤„ ' + lineNumber + ' / ' + totalLines + ')';
            }

            // output textareaì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            outputTextarea.addEventListener('click', updateLineNumber);
            outputTextarea.addEventListener('keyup', updateLineNumber);
            outputTextarea.addEventListener('focus', updateLineNumber);

            function showStatus(message, isError) {
                statusMessage.textContent = message;
                statusDiv.className = 'status ' + (isError ? 'error' : 'success');
                statusDiv.style.display = 'block';
            }

            function removeComments() {
                var sourceCode = inputTextarea.value.trim();
                
                if (!sourceCode) {
                    showStatus('ì…ë ¥ëœ ì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤.', true);
                    return;
                }

                try {
                    var result = CommentRemover.remove(sourceCode);
                    outputTextarea.value = result;

                    // ì—¬ëŸ¬ ì¤„ ì£¼ì„ ëª©ë¡ í‘œì‹œ
                    displayMultiLineComments();

                    // ê²½ê³  ë©”ì‹œì§€ í™•ì¸ ë° í‘œì‹œ
                    var warnings = CommentRemover.getWarnings();
                    var statusMessage = 'âœ… ì£¼ì„ì´ ì„±ê³µì ìœ¼ë¡œ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤!';
                    
                    if (warnings && warnings.length > 0) {
                        // ê²½ê³ ê°€ ìˆìœ¼ë©´ í‘œì‹œ
                        statusMessage = warnings.join('\n') + '\n\n' + statusMessage;
                    }

                    // ì›ë³¸ì„ LocalStorageì— ì €ì¥ (ë³µêµ¬/ê°ì‚¬ ìš©)
                    try {
                        localStorage.setItem('codechain3_originalSource', sourceCode);
                        localStorage.setItem('codechain3_originalSource_ts', new Date().toISOString());
                        statusMessage += ' (ì›ë³¸ì„ LocalStorageì— ì €ì¥í–ˆìŠµë‹ˆë‹¤)';
                        showStatus(statusMessage, warnings && warnings.length > 0);
                    } catch (e) {
                        console.warn('LocalStorage ì €ì¥ ì‹¤íŒ¨:', e);
                        showStatus(statusMessage + '\n(ì›ë³¸ì„ LocalStorageì— ì €ì¥í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤)', true);
                    }
                } catch (error) {
                    showStatus('âŒ ' + error.message, true);
                    console.error('Error:', error);
                }
            }

            function displayMultiLineComments() {
                var comments = CommentRemover.getMultiLineComments();
                var commentsSection = document.getElementById('commentsSection');
                var commentsList = document.getElementById('commentsList');
                
                if (comments.length === 0) {
                    commentsSection.style.display = 'none';
                    return;
                }
                
                commentsSection.style.display = 'block';
                commentsList.innerHTML = '';
                
                comments.forEach(function(comment, index) {
                    var btn = document.createElement('button');
                    btn.className = 'comment-item';
                    // ì¤„ ë²ˆí˜¸ ì •ë³´ í¬í•¨
                    var label = 'multi-' + String(index + 1).padStart(3, '0');
                    if (comment.startLine && comment.endLine) {
                        label += ' (L' + comment.startLine + '-L' + comment.endLine + ')';
                    }
                    btn.textContent = label;
                    btn.onclick = function() {
                        showCommentDetail(index);
                    };
                    commentsList.appendChild(btn);
                });
            }

            function showCommentDetail(index) {
                var comment = CommentRemover.getMultiLineComment(index);
                var commentDetail = document.getElementById('commentDetail');
                
                if (comment !== null) {
                    // ê°ì²´ì¸ ê²½ìš° content ì†ì„± ì‚¬ìš©, ë¬¸ìì—´ì´ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš© (í•˜ìœ„ í˜¸í™˜ì„±)
                    var content = (typeof comment === 'object') ? comment.content : comment;
                    var header = '';
                    
                    // ì¤„ ë²ˆí˜¸ ì •ë³´ê°€ ìˆìœ¼ë©´ í—¤ë”ì— í‘œì‹œ
                    if (typeof comment === 'object' && comment.startLine && comment.endLine) {
                        header = '/* Lines ' + comment.startLine + '-' + comment.endLine + ' */\n\n';
                    }
                    
                    commentDetail.value = header + content;
                }
            }

            function clearAll() {
                inputTextarea.value = '';
                outputTextarea.value = '';
                statusDiv.style.display = 'none';
                document.getElementById('commentsSection').style.display = 'none';
                document.getElementById('commentDetail').value = '';
            }

            function copyOutput() {
                if (!outputTextarea.value) {
                    showStatus('ë³µì‚¬í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.', true);
                    return;
                }

                outputTextarea.select();
                document.execCommand('copy');
                showStatus('ğŸ“‹ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }

            removeBtn.addEventListener('click', removeComments);
            restoreBtn.addEventListener('click', loadOriginalFromStorage);
            clearBtn.addEventListener('click', clearAll);
            copyBtn.addEventListener('click', copyOutput);

            inputTextarea.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 'Enter') {
                    removeComments();
                }
            });

            // í˜ì´ì§€ ë¡œë“œ ì‹œ LocalStorageì— ì €ì¥ëœ ì›ë³¸ì´ ìˆìœ¼ë©´ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
            function loadOriginalFromStorage() {
                try {
                    var saved = localStorage.getItem('codechain3_originalSource');
                    var ts = localStorage.getItem('codechain3_originalSource_ts');
                    if (saved) {
                        // í•˜ë“œì½”ë”©ëœ ìƒ˜í”Œ ëŒ€ì‹  ì €ì¥ëœ ì½”ë“œë¥¼ ë¡œë“œ
                        inputTextarea.value = saved;
                        showStatus('ğŸ”„ ì €ì¥ëœ ì›ë³¸ ë¶ˆëŸ¬ì˜´' + (ts ? ' (' + ts + ')' : ''));
                    }
                } catch (e) {
                    console.warn('LocalStorage ì½ê¸° ì‹¤íŒ¨:', e);
                }
            }

            // ì´ˆê¸° ë¡œë“œ í˜¸ì¶œ
            loadOriginalFromStorage();
        })();
    </script>
</body>
</html>