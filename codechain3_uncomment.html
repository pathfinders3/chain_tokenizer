<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript ì£¼ì„ ì œê±°ê¸°</title>
    <!-- styles moved to external file -->
    <link rel="stylesheet" href="codechain3_uncomment.css">
</head>
<body>
    <div class="container">
        <h1>ğŸ§¹ JavaScript ì£¼ì„ ì œê±°ê¸°</h1>
        <p class="description">Esprimaë¥¼ ì‚¬ìš©í•˜ì—¬ JavaScript ì½”ë“œì—ì„œ ì£¼ì„ì„ ì œê±°í•©ë‹ˆë‹¤ (ì¤„ êµ¬ì¡° ìœ ì§€)</p>

        <div class="editor-container">
            <div class="editor-section">
                <h2>ì…ë ¥ (ì£¼ì„ í¬í•¨)</h2>
                <textarea id="input" placeholder="ì—¬ê¸°ì— JavaScript ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
            </div>

            <div class="editor-section">
                <h2>ì¶œë ¥ (ì£¼ì„ ì œê±°ë¨)</h2>
                <textarea id="output" readonly placeholder="ì£¼ì„ì´ ì œê±°ëœ ì½”ë“œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤..."></textarea>
            </div>
        </div>

        <div class="button-container">
            <button id="removeBtn">ì£¼ì„ ì œê±°</button>
            <button id="restoreBtn">ì›ë³¸ ë¶ˆëŸ¬ì˜¤ê¸°</button>
            <button id="copyBtn">ê²°ê³¼ ë³µì‚¬</button>
            <button id="clearBtn">ì´ˆê¸°í™”</button>
        </div>

        <div id="status" class="status"></div>
    </div>

    <!-- Esprima CDN -->
    <script src="https://cdn.jsdelivr.net/npm/esprima@4.0.1/dist/esprima.min.js"></script>

    
    <!-- Comment Remover Library -->
    <script src="codechain3_uncomment.js"></script>

    <script>
        (function() {
            var inputTextarea = document.getElementById('input');
            var outputTextarea = document.getElementById('output');
            var removeBtn = document.getElementById('removeBtn');
            var restoreBtn = document.getElementById('restoreBtn');
            var clearBtn = document.getElementById('clearBtn');
            var copyBtn = document.getElementById('copyBtn');
            var statusDiv = document.getElementById('status');

            function showStatus(message, isError) {
                statusDiv.textContent = message;
                statusDiv.className = 'status ' + (isError ? 'error' : 'success');
                
                setTimeout(function() {
                    statusDiv.style.display = 'none';
                }, 3000);
            }

            function removeComments() {
                var sourceCode = inputTextarea.value.trim();
                
                if (!sourceCode) {
                    showStatus('ì…ë ¥ëœ ì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤.', true);
                    return;
                }

                try {
                    var result = CommentRemover.remove(sourceCode);
                    outputTextarea.value = result;

                    // ì›ë³¸ì„ LocalStorageì— ì €ì¥ (ë³µêµ¬/ê°ì‚¬ ìš©)
                    try {
                        localStorage.setItem('codechain3_originalSource', sourceCode);
                        localStorage.setItem('codechain3_originalSource_ts', new Date().toISOString());
                        showStatus('âœ… ì£¼ì„ì´ ì„±ê³µì ìœ¼ë¡œ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤! (ì›ë³¸ì„ LocalStorageì— ì €ì¥í–ˆìŠµë‹ˆë‹¤)');
                    } catch (e) {
                        console.warn('LocalStorage ì €ì¥ ì‹¤íŒ¨:', e);
                        showStatus('âœ… ì£¼ì„ ì œê±°ë¨. (ì›ë³¸ì„ LocalStorageì— ì €ì¥í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤)', true);
                    }
                } catch (error) {
                    showStatus('âŒ ' + error.message, true);
                    console.error('Error:', error);
                }
            }

            function clearAll() {
                inputTextarea.value = '';
                outputTextarea.value = '';
                statusDiv.style.display = 'none';
            }

            function copyOutput() {
                if (!outputTextarea.value) {
                    showStatus('ë³µì‚¬í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.', true);
                    return;
                }

                outputTextarea.select();
                document.execCommand('copy');
                showStatus('ğŸ“‹ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }

            removeBtn.addEventListener('click', removeComments);
            restoreBtn.addEventListener('click', loadOriginalFromStorage);
            clearBtn.addEventListener('click', clearAll);
            copyBtn.addEventListener('click', copyOutput);

            inputTextarea.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 'Enter') {
                    removeComments();
                }
            });

            // í˜ì´ì§€ ë¡œë“œ ì‹œ LocalStorageì— ì €ì¥ëœ ì›ë³¸ì´ ìˆìœ¼ë©´ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
            function loadOriginalFromStorage() {
                try {
                    var saved = localStorage.getItem('codechain3_originalSource');
                    var ts = localStorage.getItem('codechain3_originalSource_ts');
                    if (saved) {
                        // í•˜ë“œì½”ë”©ëœ ìƒ˜í”Œ ëŒ€ì‹  ì €ì¥ëœ ì½”ë“œë¥¼ ë¡œë“œ
                        inputTextarea.value = saved;
                        showStatus('ğŸ”„ ì €ì¥ëœ ì›ë³¸ ë¶ˆëŸ¬ì˜´' + (ts ? ' (' + ts + ')' : ''));
                    }
                } catch (e) {
                    console.warn('LocalStorage ì½ê¸° ì‹¤íŒ¨:', e);
                }
            }

            // ì´ˆê¸° ë¡œë“œ í˜¸ì¶œ
            loadOriginalFromStorage();
        })();
    </script>
</body>
</html>