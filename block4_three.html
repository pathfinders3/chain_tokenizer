<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>저장된 그룹 렌더링</title>
    <link rel="icon" type="image/png" href="block4.png">

    <!-- 같은 이름의 CSS -->
    <link rel="stylesheet" href="block4_three.css">
    
    <!-- Three.js 라이브러리 (importmap 사용) -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        }
    }
    </script>
</head>

<body>
	
<div class="container">
        
        <div class="controls">
            <button id="pasteBtn" title="클립보드에서 붙여넣기" style="background: #2E2019;">📋 붙여넣기</button>
            <button id="loadFromStorageBtn" title="localStorage에서 불러오기" style="background: #2E2019;">💾 Load</button>            
            <button id="copyBtn" title="현재 데이터를 클립보드에 복사" style="background: #2E2019;">📋 복사</button>
            <button id="renderBtn">🎨 렌더링</button>
            <button id="clearBtn">🗑️ 캔버스 지우기</button>
            <button id="infoBtn">ℹ️ 정보 출력</button>
            <button id="toggleViewControlsBtn" style="background: #2a2a2a;">🔧 뷰 설정 토글</button>
            <button id="toggleTextareaBtn" style="background: #2a2a2a;">📝 입력창 토글</button>
            <button id="toggleGridControlsBtn" style="background: #2a2a2a;">🔲 격자 설정 토글</button>
        </div>

        <div class="controls">
            <label style="font-weight: bold; color: #667eea;">카메라 뷰:</label>
            <button id="viewXYBtn" title="정면 (XY 평면)">XY</button>
            <button id="viewXZBtn" title="위 (XZ 평면)">XZ</button>
            <button id="viewYZBtn" title="측면 (YZ 평면)">YZ</button>
            <label style="font-weight: bold; color: #667eea; margin-left: 20px;">회전 모드:</label>
            <button id="rotateHorizontalBtn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">↔️ 좌우 회전</button>
            <button id="rotateVerticalBtn">↕️ 위아래 회전</button>
        </div>

        <textarea id="jsonInput" placeholder="여기에 JSON 데이터를 붙여넣으세요..." style="display: none;"></textarea>

        <div class="controls" id="viewControls">
            <div class="slider-group">
                <label>스케일:</label>
                <input type="range" id="scaleSlider" min="20" max="150" value="60" step="5">
                <span id="scaleValue">60%</span>
            </div>

            <div class="slider-group">
                <label>카메라 거리:</label>
                <span id="cameraDistanceValue" style="color: #667eea; font-weight: bold;">500</span>
            </div>

            <div class="slider-group">
                <label>다음 점까지 거리:</label>
                <span id="nextPointDistanceValue" style="color: #f093fb; font-weight: bold;">-</span>
            </div>

            <div class="slider-group">
                <label>선택된 그룹:</label>
                <span id="selectedGroupValue" style="color: #ffd93d; font-weight: bold;">-</span>
            </div>

            <div class="slider-group">
                <label>점 크기:</label>
                <input type="range" id="pointSizeSlider" min="1" max="10" value="3" step="1">
                <span id="pointSizeValue">3</span>
            </div>

            <div class="slider-group">
                <label>선 두께:</label>
                <input type="range" id="lineWidthSlider" min="1" max="5" value="2" step="1">
                <span id="lineWidthValue">2</span>
            </div>

            <div class="checkbox-group">
                <input type="checkbox" id="showPointsCheck" checked>
                <label for="showPointsCheck">점 표시</label>
            </div>

            <div class="checkbox-group">
                <input type="checkbox" id="showLinesCheck" checked>
                <label for="showLinesCheck">선 표시</label>
            </div>
        </div>

        <div class="controls">
            <label style="font-weight: bold; color: #f093fb;">회전 자취:</label>
            <button id="createRotationTraceBtn" title="선택된 점의 회전 자취를 새 그룹으로 생성">🔄 자취 생성</button>
            <button id="deleteTraceBtn" title="선택된 자취 전체 삭제" style="background: #ff4757;">🗑️ 자취 삭제</button>
            <button id="analyzeTracesBtn" title="모든 자취 그룹의 점 개수 출력" style="background: #667eea;">📊 자취 분석</button>
            <button id="createEllipsesFromTwoGroupsBtn" title="두 선택된 그룹의 대응 점 쌍을 장축으로 하는 타원들 생성" style="background: linear-gradient(135deg, #f093fb 0%, #667eea 100%);">⭕ 쌍타원 생성</button>
            <button id="createMeshBtn" title="자취들을 연결한 3D 메쉬 생성" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">🎭 메쉬 생성</button>
            <button id="deleteMeshBtn" title="생성된 메쉬 삭제" style="background: #ff4757; display: none;">🗑️ 메쉬 삭제</button>
            <label style="font-size: 12px; color: #b0b0b0;">t 범위:</label>
            <input type="number" id="tStartInput" value="0" step="0.1" style="width: 60px; padding: 5px; background: #16213e; color: #e0e0e0; border: 1px solid #444; border-radius: 3px;">
            <label style="font-size: 12px; color: #b0b0b0;">~</label>
            <input type="number" id="tEndInput" value="6.28" step="0.1" style="width: 60px; padding: 5px; background: #16213e; color: #e0e0e0; border: 1px solid #444; border-radius: 3px;">
            <label style="font-size: 12px; color: #b0b0b0;">간격:</label>
            <input type="number" id="tStepInput" value="0.3" step="0.05" min="0.01" style="width: 60px; padding: 5px; background: #16213e; color: #e0e0e0; border: 1px solid #444; border-radius: 3px;">
            <div class="checkbox-group" style="margin-left: 15px;">
                <input type="checkbox" id="ellipseModeCheck">
                <label for="ellipseModeCheck" style="color: #f093fb;">⭕ 타원 모드 (XZ평면)</label>
            </div>
        </div>

        <div class="controls" id="ellipseControls" style="display: none;">
            <label style="font-size: 12px; color: #f093fb;">타원 반지름:</label>
            <label style="font-size: 12px; color: #b0b0b0; margin-left: 10px;">X방향(장축):</label>
            <input type="number" id="ellipseRadiusXInput" value="50" step="0.5" min="0.1" style="width: 70px; padding: 5px; background: #16213e; color: #e0e0e0; border: 1px solid #444; border-radius: 3px;">
            <label style="font-size: 12px; color: #b0b0b0; margin-left: 15px;">Z방향(단축):</label>
            <input type="number" id="ellipseRadiusZInput" value="20" step="0.5" min="0.1" style="width: 70px; padding: 5px; background: #16213e; color: #e0e0e0; border: 1px solid #444; border-radius: 3px;">
            <button id="setMajorAxisByMouseBtn" title="마우스로 XY 평면에서 두 번째 점을 찍어 장축 길이 결정" style="padding: 5px 10px; font-size: 12px; background: #667eea; margin-left: 15px;">📏 마우스로 장축 설정</button>
            <label style="font-size: 12px; color: #ffd93d; margin-left: 20px;">장축:</label>
            <span id="majorAxisValue" style="font-size: 12px; color: #ffd93d; font-weight: bold;">10.0</span>
            <label style="font-size: 12px; color: #ffd93d; margin-left: 10px;">단축:</label>
            <span id="minorAxisValue" style="font-size: 12px; color: #ffd93d; font-weight: bold;">5.0</span>
            <button id="previewAxesBtn" title="타원의 장축과 단축을 직선으로 미리보기" style="padding: 5px 10px; font-size: 12px; background: #667eea; margin-left: 15px;">👁️ 축 미리보기</button>
            <button id="clearPreviewBtn" title="축 미리보기 제거" style="padding: 5px 10px; font-size: 12px; background: #ff4757; display: none;">❌ 미리보기 제거</button>
            
            <!-- 장축 끝점 선택 라디오 추가 -->
            <div style="display: inline-block; margin-left: 15px; color: #b0b0b0;">
                <label style="font-size: 12px; color: #ffd93d; margin-right: 8px;">장축 끝점:</label>
                <input type="radio" id="ellipseEndpointA" name="ellipseEndpoint" value="A" checked>
                <label for="ellipseEndpointA" style="font-size: 12px; color: #b0b0b0; margin-right: 6px;">끝점 A</label>
                <input type="radio" id="ellipseEndpointB" name="ellipseEndpoint" value="B">
                <label for="ellipseEndpointB" style="font-size: 12px; color: #b0b0b0;">끝점 B</label>
            </div>
        </div>

        <div class="controls">
            <label style="font-size: 12px; color: #b0b0b0;">회전축 방향:</label>
            <select id="rotationAxisSelect" style="padding: 5px; background: #16213e; color: #e0e0e0; border: 1px solid #444; border-radius: 3px;">
                <option value="Y" selected>Y축 (좌우)</option>
                <option value="X">X축 (전후)</option>
                <option value="Z">Z축 (상하)</option>
            </select>
            <label style="font-size: 12px; color: #b0b0b0; margin-left: 15px;">좌표 모드:</label>
            <input type="radio" id="relativeModeRadio" name="coordMode" value="relative" checked style="margin-left: 5px;">
            <label for="relativeModeRadio" style="font-size: 12px; color: #b0b0b0; margin-right: 10px;">상대</label>
            <input type="radio" id="absoluteModeRadio" name="coordMode" value="absolute">
            <label for="absoluteModeRadio" style="font-size: 12px; color: #b0b0b0;">절대</label>
            <label id="axisPositionLabel" style="font-size: 12px; color: #b0b0b0; margin-left: 10px;">축 위치:</label>
            <label id="axisXLabel" style="font-size: 12px; color: #b0b0b0;">dx=</label>
            <input type="number" id="axisXInput" value="0" step="1" style="width: 50px; padding: 5px; background: #16213e; color: #e0e0e0; border: 1px solid #444; border-radius: 3px;">
            <label id="axisYLabel" style="font-size: 12px; color: #b0b0b0;">dy=</label>
            <input type="number" id="axisYInput" value="0" step="1" style="width: 50px; padding: 5px; background: #16213e; color: #e0e0e0; border: 1px solid #444; border-radius: 3px;">
            <label id="axisZLabel" style="font-size: 12px; color: #b0b0b0;">dz=</label>
            <input type="number" id="axisZInput" value="0" step="1" style="width: 50px; padding: 5px; background: #16213e; color: #e0e0e0; border: 1px solid #444; border-radius: 3px;">
            <label style="font-size: 12px; color: #b0b0b0; margin-left: 15px;">선택된 점:</label>
            <span id="selectedPointCoords" style="color: #f093fb; font-weight: bold; min-width: 150px;">-</span>
            <button id="copyToAxisBtn" title="선택된 점의 좌표를 축 위치로 복사" style="padding: 5px 10px; font-size: 12px;">📍 축 위치로 복사</button>
        </div>

        <!-- 타원 단축 조정 컨트롤 (타원 선택 시만 표시) -->
        <div class="controls" id="ellipseMinorAxisControls" style="display: none; background: linear-gradient(135deg, #f093fb 0%, #667eea 100%); padding: 10px; border-radius: 5px;">
            <label style="font-weight: bold; color: #fff;">⭕ 선택된 타원 단축 조정:</label>
            <input type="range" id="ellipseMinorAxisSlider" min="1" max="200" value="20" step="0.5" style="width: 300px; margin: 0 10px;">
            <span id="ellipseMinorAxisValue" style="color: #fff; font-weight: bold; min-width: 60px; display: inline-block;">20.0</span>
            <label style="color: #fff; margin-left: 10px;">장축:</label>
            <span id="ellipseMajorAxisDisplay" style="color: #ffd93d; font-weight: bold; min-width: 60px; display: inline-block;">-</span>
        </div>

        <div class="controls">
            <label style="font-weight: bold; color: #ffd93d;">선택된 그룹 이동:</label>
            <button id="moveXPlusBtn" title="X 방향으로 +100 이동" style="padding: 5px 10px; font-size: 12px; background: #667eea;">X +100</button>
            <button id="moveXMinusBtn" title="X 방향으로 -100 이동" style="padding: 5px 10px; font-size: 12px; background: #667eea;">X -100</button>
            <button id="moveYPlusBtn" title="Y 방향으로 +100 이동" style="padding: 5px 10px; font-size: 12px; background: #764ba2;">Y +100</button>
            <button id="moveYMinusBtn" title="Y 방향으로 -100 이동" style="padding: 5px 10px; font-size: 12px; background: #764ba2;">Y -100</button>
            <button id="moveZPlusBtn" title="Z 방향으로 +100 이동" style="padding: 5px 10px; font-size: 12px; background: #f093fb;">Z +100</button>
            <button id="moveZMinusBtn" title="Z 방향으로 -100 이동" style="padding: 5px 10px; font-size: 12px; background: #f093fb;">Z -100</button>
        </div>

        <div class="controls" id="gridControls" style="display: none;">
            <div class="checkbox-group">
                <input type="checkbox" id="showGridCheck">
                <label for="showGridCheck">Grid</label>
            </div>

            <button id="clearHighlightedLinesBtn">Remove H/L</button>

            <div class="slider-group">
                <label>격자 평면:</label>
                <select id="gridPlaneSelect">
                    <option value="XY" selected>XY 평면</option>
                    <option value="XZ">XZ 평면</option>
                    <option value="YZ">YZ 평면</option>
                </select>
            </div>

            <div class="slider-group">
                <label>격자 크기:</label>
                <input type="range" id="gridSizeSlider" min="500" max="2000" value="1000" step="50">
                <span id="gridSizeValue">1000</span>
            </div>

            <div class="slider-group">
                <label>격자 간격:</label>
                <input type="range" id="gridDivisionsSlider" min="10" max="100" value="20" step="5">
                <span id="gridDivisionsValue">50</span>
            </div>
        </div>

        <canvas id="canvas" width="1200" height="800"></canvas>

        <div class="info">
            <h3>사용 방법</h3>
            <ol>
                <li><strong>클립보드에서 붙여넣기:</strong> block3_vectors.html에서 '모든 그룹 저장' 버튼을 눌러 클립보드에 복사한 후, 이 버튼을 클릭하세요.</li>
                <li><strong>localStorage에서 불러오기:</strong> 같은 브라우저에서 저장한 데이터를 불러옵니다.</li>
                <li><strong>렌더링:</strong> JSON 데이터를 캔버스에 그립니다.</li>
                <li><strong>마우스 조작:</strong> 드래그로 회전, 휠로 확대/축소, 우클릭 드래그로 이동</li>
                <li><strong>카메라 뷰:</strong> 정면(XY), 위(XZ), 측면(YZ) 버튼으로 시점 전환</li>
                <li><strong>스케일/크기 조정:</strong> 슬라이더를 조정하면 실시간으로 적용됩니다.</li>
            </ol>
        </div>
    </div>

    <!-- renderSavedGroups.js 함수를 여기에 포함 -->
    <script type="module" src="block4_three.js"></script>
	
</body>
</html>
	